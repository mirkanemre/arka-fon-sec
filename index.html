<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OtoFonFX | Dashboard</title>
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* DASHBOARD Ã–ZEL STÄ°L DÃœZELTMELERÄ° */
        body {
            /* Body padding'i 0 yapalÄ±m ki container tam yÃ¼ksekliÄŸi kontrol edebilsin */
            padding: 0 !important; 
        }

        #app-container {
            width: 100%;
            max-width: 500px;
            min-height: 100vh; /* EkranÄ±n tamamÄ±nÄ± kapla */
            display: flex;
            flex-direction: column;
            padding: 24px; /* BoÅŸluÄŸu iÃ§eriye aldÄ±k */
            margin: 0 auto; /* Ortala */
        }

        .menu-grid {
            max-width: 100% !important; 
            width: 100%;
        }

        /* Footer'Ä± en aÅŸaÄŸÄ±ya zorlayan komut */
        .footer {
            margin-top: auto !important; 
            padding-top: 40px;
            padding-bottom: 20px; /* Telefonun alt barÄ± iÃ§in pay */
        }

        @media (max-width: 480px) {
            #app-container { padding: 15px; }
            .footer { padding-bottom: 30px; } /* Mobilde biraz daha pay bÄ±rak */
        }
    </style>
</head>
<body>

    <div id="app-container">
        <div class="user-status-bar">
            <div class="credit-badge">
                <span id="user-credit-count">..</span>
                <span>KREDÄ°</span>
            </div>
        </div>

        <div id="registration-banner" style="display: none;" onclick="navigate('kayit.html')">
            <div class="promo-content">
                <h3>ğŸ 10 KREDÄ° HEDÄ°YENÄ°ZÄ° ALIN</h3>
                <p>DÃ¼kkan kaydÄ±nÄ±zÄ± tamamlayÄ±n, hemen Ã¼retime baÅŸlayÄ±n.</p>
            </div>
        </div>

        <div class="logo-area">
            <h1>OTOFONFX</h1>
            <p style="font-size: 0.58rem; color: var(--primary); letter-spacing: 3px; text-transform: uppercase; font-weight: 900; margin-top: 5px;">Pro Studio Engine</p>
        </div>

        <div class="menu-grid">
            
            <div class="main-card studio-card" onclick="navigate('arka_fon.html')">
                <h2>StÃ¼dyo Konsept Ã–rnekleri</h2>
                <p>Arka fon konseptinizi seÃ§in ve Ã§ekimi baÅŸlatÄ±n.</p>
                <div class="card-icon">ğŸ–¼ï¸</div>
            </div>

            <div class="main-card store-card" onclick="navigate('kredial.html')">
                <h2>Kredi MaÄŸazasÄ±</h2>
                <p>Paket yÃ¼kleyin, Ã§ekime kesintisiz devam edin.</p>
                <div class="card-icon">ğŸ’³</div>
            </div>

            <div class="main-card active-card" onclick="navigate('secili_konsept_index.html')">
                <h2>SeÃ§ili Konsept</h2>
                <p id="active-status-text">HenÃ¼z bir konsept seÃ§ilmedi.</p>
                <div class="card-icon">âœ¨</div>
            </div>

        </div>

        <div class="footer">
            Â© 2026 OTOFONFX TECHNOLOGIES<br>
            <span style="opacity: 0.5;">v3.5.1 PREMIUM ACCESS</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const _supabase = supabase.createClient("https://bhyeemsvcforqnddhoot.supabase.co", "sb_publishable_9txqLMJcZ5XSNd-DuOWRbg_kXhwlR6q");
        
        tg.ready();
        tg.expand();
        tg.headerColor = "#000000";

        function navigate(url) {
            tg.HapticFeedback.impactOccurred('medium');
            setTimeout(() => {
                window.location.href = url;
            }, 50);
        }

        async function initDashboard() {
            const userId = String(tg.initDataUnsafe?.user?.id || "1017604800");
            
            let { data: record } = await _supabase
                .from('galeriler')
                .select('chat_id, kalan_kredi, kayitli_arkaplan_url, stand_gorseli_url')
                .eq('chat_id', userId)
                .maybeSingle();

            if (!record) {
                document.getElementById('registration-banner').style.display = 'block';
                document.getElementById('user-credit-count').innerText = "0";
            } else {
                document.getElementById('user-credit-count').innerText = record.kalan_kredi || "0";
                const statusText = document.getElementById('active-status-text');
                
                if (record.kayitli_arkaplan_url) {
                    statusText.innerText = "Aktif fonunuz kullanÄ±ma hazÄ±r.";
                    statusText.style.color = "#34c759";
                } 
                else if (record.stand_gorseli_url) {
                    statusText.innerText = "Taslak konseptiniz var. Kurulumu tamamlayÄ±n.";
                    statusText.style.color = "#f59e0b";
                } 
                else {
                    statusText.innerText = "Mevcut konseptinizi gÃ¶rÃ¼ntÃ¼leyin.";
                    statusText.style.color = "#8e8e93";
                }
            }
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
