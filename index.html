<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OtoFonFX | Dashboard</title>
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        #app-container {
            width: 100%;
            max-width: 500px; /* SimÃ¼latÃ¶r ile aynÄ± geniÅŸlik */
        }
        /* MenÃ¼ grid'i 400px sÄ±nÄ±rÄ±ndan kurtarÄ±p 500px'e yayÄ±yoruz */
        .menu-grid {
            max-width: 100% !important; 
        }
    </style>
</head>
<body>

    <div id="app-container">
        <div class="user-status-bar">
            <div class="credit-badge">
                <span id="user-credit-count">..</span>
                <span>KREDÄ°</span>
            </div>
        </div>

        <div id="registration-banner" style="display: none;" onclick="navigate('kayit.html')">
            <div class="promo-content">
                <h3>ğŸ 10 KREDÄ° HEDÄ°YENÄ°ZÄ° ALIN</h3>
                <p>DÃ¼kkan kaydÄ±nÄ±zÄ± tamamlayÄ±n, hemen Ã¼retime baÅŸlayÄ±n.</p>
            </div>
        </div>

        <div class="logo-area">
            <h1>OTOFONFX</h1>
            <p style="font-size: 0.58rem; color: var(--primary); letter-spacing: 3px; text-transform: uppercase; font-weight: 900; margin-top: 5px;">Pro Studio Engine</p>
        </div>

        <div class="menu-grid">
            
            <div class="main-card studio-card" onclick="navigate('arka_fon.html')">
                <h2>StÃ¼dyo Konsept Ã–rnekleri</h2>
                <p>Arka fon konseptinizi seÃ§in ve Ã§ekimi baÅŸlatÄ±n.</p>
                <div class="card-icon">ğŸ–¼ï¸</div>
            </div>

            <div class="main-card store-card" onclick="navigate('kredial.html')">
                <h2>Kredi MaÄŸazasÄ±</h2>
                <p>Paket yÃ¼kleyin, Ã§ekime kesintisiz devam edin.</p>
                <div class="card-icon">ğŸ’³</div>
            </div>

            <div class="main-card active-card" onclick="navigate('secili_konsept_index.html')">
                <h2>SeÃ§ili Konsept</h2>
                <p id="active-status-text">HenÃ¼z bir konsept seÃ§ilmedi.</p>
                <div class="card-icon">âœ¨</div>
            </div>

        </div>

        <div class="footer">
            Â© 2026 OTOFONFX TECHNOLOGIES<br>
            <span style="opacity: 0.5;">v3.5.0 PREMIUM ACCESS</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const _supabase = supabase.createClient("https://bhyeemsvcforqnddhoot.supabase.co", "sb_publishable_9txqLMJcZ5XSNd-DuOWRbg_kXhwlR6q");
        
        tg.ready();
        tg.expand();
        tg.headerColor = "#000000";

        function navigate(url) {
            tg.HapticFeedback.impactOccurred('medium');
            setTimeout(() => {
                window.location.href = url;
            }, 50);
        }

        async function initDashboard() {
            const userId = tg.initDataUnsafe?.user?.id || 1017604800;
            
            // TÃ¼m gerekli sÃ¼tunlarÄ± Ã§ekiyoruz
            let { data: record } = await _supabase
                .from('galeriler')
                .select('chat_id, kalan_kredi, kayitli_arkaplan_url, stand_gorseli_url')
                .eq('chat_id', userId)
                .maybeSingle();

            if (!record) {
                // KayÄ±tlÄ± deÄŸilse
                document.getElementById('registration-banner').style.display = 'block';
                document.getElementById('user-credit-count').innerText = "0";
            } else {
                // KayÄ±tlÄ±ysa
                document.getElementById('user-credit-count').innerText = record.kalan_kredi || "0";
                
                // --- DURUM METNÄ° MANTIÄI ---
                const statusText = document.getElementById('active-status-text');
                
                if (record.kayitli_arkaplan_url) {
                    // 1. En iyi durum: Aktif sahne var
                    statusText.innerText = "Aktif fonunuz kullanÄ±ma hazÄ±r.";
                    statusText.style.color = "#34c759"; // YeÅŸil
                } 
                else if (record.stand_gorseli_url) {
                    // 2. Ara durum: Fon seÃ§miÅŸ ama henÃ¼z logo koyup Ã¼retmemiÅŸ
                    statusText.innerText = "Taslak konseptiniz var. Kurulumu tamamlayÄ±n.";
                    statusText.style.color = "#f59e0b"; // SarÄ±
                } 
                else {
                    // 3. BaÅŸlangÄ±Ã§: HiÃ§bir ÅŸey yok
                    statusText.innerText = "Mevcut konseptinizi gÃ¶rÃ¼ntÃ¼leyin.";
                    statusText.style.color = "#8e8e93"; // Gri
                }
            }
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
