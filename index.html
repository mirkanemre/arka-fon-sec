<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OtoFonFX | Dashboard</title>
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div id="app-container">
        <div class="user-status-bar">
            <div class="credit-badge">
                <span id="user-credit-count">..</span>
                <span>KREDÄ°</span>
            </div>
        </div>

        <div id="registration-banner" style="display: none;" onclick="navigate('kayit.html')">
            <div class="promo-content">
                <h3>ğŸ 10 KREDÄ° HEDÄ°YENÄ°ZÄ° ALIN</h3>
                <p>DÃ¼kkan kaydÄ±nÄ±zÄ± tamamlayÄ±n, hemen Ã¼retime baÅŸlayÄ±n.</p>
            </div>
        </div>

        <div class="logo-area">
            <h1>OTOFONFX</h1>
            <p style="font-size: 0.58rem; color: var(--primary); letter-spacing: 3px; text-transform: uppercase; font-weight: 900; margin-top: 5px;">Pro Studio Engine</p>
        </div>

        <div class="menu-grid">
            
            <div class="main-card studio-card" onclick="navigate('arka_fon.html')">
                <h2>StÃ¼dyo Konsept Ã–rnekleri</h2>
                <p>Arka fon konseptinizi seÃ§in ve Ã§ekimi baÅŸlatÄ±n.</p>
                <div class="card-icon">ğŸ–¼ï¸</div>
            </div>

            <div class="main-card store-card" onclick="navigate('kredial.html')">
                <h2>Kredi MaÄŸazasÄ±</h2>
                <p>Paket yÃ¼kleyin, Ã§ekime kesintisiz devam edin.</p>
                <div class="card-icon">ğŸ’³</div>
            </div>

            <div class="main-card active-card" onclick="navigate('aktif_fon.html')">
                <h2>SeÃ§ili Konsept</h2>
                <p id="active-status-text">Mevcut konseptinizi gÃ¶rÃ¼ntÃ¼leyin.</p>
                <div class="card-icon">âœ¨</div>
            </div>

        </div>

        <div class="footer">
            Â© 2026 OTOFONFX TECHNOLOGIES<br>
            <span style="opacity: 0.5;">v3.1.0 PREMIUM ACCESS</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const _supabase = supabase.createClient("https://bhyeemsvcforqnddhoot.supabase.co", "sb_publishable_9txqLMJcZ5XSNd-DuOWRbg_kXhwlR6q");
        
        tg.ready();
        tg.expand();
        tg.headerColor = "#000000";

        // Sayfa DeÄŸiÅŸtirme Fonksiyonu
        function navigate(url) {
            tg.HapticFeedback.impactOccurred('medium');
            setTimeout(() => {
                window.location.href = url;
            }, 50);
        }

        async function initDashboard() {
            const userId = tg.initDataUnsafe?.user?.id || 1017604800;
            
            let { data: record } = await _supabase
                .from('galeriler')
                .select('chat_id, kalan_kredi, kayitli_arkaplan_url')
                .eq('chat_id', userId)
                .maybeSingle();

            if (!record) {
                // KayÄ±tlÄ± deÄŸilse Mor Banner gÃ¶rÃ¼nÃ¼r
                document.getElementById('registration-banner').style.display = 'block';
                document.getElementById('user-credit-count').innerText = "0";
            } else {
                document.getElementById('user-credit-count').innerText = record.kalan_kredi || "0";
                if (record.kayitli_arkaplan_url) {
                    document.getElementById('active-status-text').innerText = "Aktif fonunuz kullanÄ±ma hazÄ±r.";
                }
            }
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
