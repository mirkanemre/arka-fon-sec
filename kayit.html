<!DOCTYPE html>
<html lang="tr">
<head>
    <script src="js/config.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OtoFonFX | Hediye KayÄ±t</title>
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* KAYIT SAYFASI Ã–ZEL STÄ°LLERÄ° */
        body { padding: 0 !important; }

        #main-content {
            width: 100%;
            max-width: 500px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 24px;
            margin: 0 auto;
        }

        /* Checkbox Ã–zel TasarÄ±mÄ± */
        input[type="checkbox"] {
            -webkit-appearance: none; appearance: none;
            background-color: #fff !important; border: 2px solid var(--primary);
            border-radius: 6px; width: 24px; height: 24px;
            display: grid; place-content: center; cursor: pointer; margin-right: 10px; flex-shrink: 0;
        }
        input[type="checkbox"]:checked { background-color: var(--primary) !important; }
        input[type="checkbox"]:checked::before { content: "âœ”"; color: white; font-size: 14px; font-weight: 900; }

        /* Footer Alt Sabitleme */
        .footer {
            margin-top: auto !important; 
            padding-top: 40px;
            padding-bottom: 30px;
            text-align: center;
        }

        @media (max-width: 480px) {
            #main-content { padding: 15px; }
        }
    </style>
</head>
<body>

    <div id="main-content">
        <div class="nav-header">
            <a href="javascript:void(0)" onclick="window.history.back()" class="back-link">â® GERÄ°</a>
            <div class="version-label" style="font-size: 0.6rem; color: #48484a; font-weight: 600;"></div>
        </div>

        <div id="registration-banner" style="display: block; cursor: default;">
            <div class="promo-content">
                <h3>ğŸ KAYIT OL, 10 KREDÄ° KAZAN!</h3>
                <p>Bilgilerini doldur, ilk 10 Ã§ekimin bizden olsun.</p>
            </div>
        </div>

        <div class="form-card">
            <div class="input-group">
                <label>Galeri AdÄ± *</label>
                <input type="text" id="galeri-adi" placeholder="Ã–rn: OtoFon Galeri">
            </div>
            <div class="input-group">
                <label>Yetkili AdÄ± SoyadÄ± *</label>
                <input type="text" id="yetkili-adi" placeholder="Ad Soyad">
            </div>
            <div class="input-group">
                <label>Telefon NumarasÄ± *</label>
                <input type="tel" id="tel-no" placeholder="05XX XXX XX XX">
            </div>
            <div class="input-group">
                <label>Åehir *</label>
                <div style="position: relative;">
                    <select id="sehir-select">
                        <option value="">LÃ¼tfen Åehir SeÃ§in</option>
                    </select>
                </div>
            </div>
            <div class="input-group" style="flex-direction: row; align-items: center; margin-top: 8px;">
                <input type="checkbox" id="kvkk-check">
                <label for="kvkk-check" style="font-size: 0.7rem; color: #fff; text-transform: none; padding: 0; cursor: pointer; line-height: 1.4;">
                    <span onclick="openKvkk(event)" style="color: var(--primary); text-decoration: underline; font-weight: 800;">KVKK AydÄ±nlatma Metni</span>'ni okudum ve onaylÄ±yorum.
                </label>
            </div>
            <button class="btn-submit" id="submit-btn" onclick="handleRegister()">
                10 Kredimi TanÄ±mla ve Kaydol
            </button>
        </div>

        <div class="footer"></div>
    </div>

    <div id="kvkk-modal">
        <div style="background: var(--card-bg); border: 1px solid var(--border); padding: 25px; border-radius: 24px; max-height: 80vh; width: 100%; max-width: 500px; display: flex; flex-direction: column;">
            <h3 style="margin-top: 0; font-family: 'Orbitron'; font-size: 1rem; text-align: center; color: var(--primary); margin-bottom: 15px;">AYDINLATMA METNÄ°</h3>
            <div style="overflow-y: auto; text-align: left; font-size: 0.7rem; color: #ccc; line-height: 1.6; margin-bottom: 20px; padding-right: 5px; border-top: 1px solid var(--border); padding-top: 10px;">
                <p><strong>1. Veri Sorumlusu:</strong><br>OtoFonFX tarafÄ±ndan iÅŸlenmektedir.</p>
                <p><strong>2. AmaÃ§:</strong><br>Ãœyelik oluÅŸturma ve hizmet sunumu.</p>
                <p><strong>3. PaylaÅŸÄ±m:</strong><br>Verileriniz Ã¼Ã§Ã¼ncÃ¼ ÅŸahÄ±slarla paylaÅŸÄ±lmaz.</p>
            </div>
            <button onclick="closeKvkk()" class="btn-submit" style="padding: 14px; font-size: 0.75rem; margin-top: auto;">OKUDUM, ANLADIM</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const _supabase = supabase.createClient("https://bhyeemsvcforqnddhoot.supabase.co", "sb_publishable_9txqLMJcZ5XSNd-DuOWRbg_kXhwlR6q");

        tg.ready(); tg.expand(); tg.headerColor = "#000000";

        const sehirler = ["Ä°stanbul", "Ankara", "Ä°zmir", "Adana", "AdÄ±yaman", "Afyonkarahisar", "AÄŸrÄ±", "Aksaray", "Amasya", "Antalya", "Ardahan", "Artvin", "AydÄ±n", "BalÄ±kesir", "BartÄ±n", "Batman", "Bayburt", "Bilecik", "BingÃ¶l", "Bitlis", "Bolu", "Burdur", "Bursa", "Ã‡anakkale", "Ã‡ankÄ±rÄ±", "Ã‡orum", "Denizli", "DiyarbakÄ±r", "DÃ¼zce", "Edirne", "ElazÄ±ÄŸ", "Erzincan", "Erzurum", "EskiÅŸehir", "Gaziantep", "Giresun", "GÃ¼mÃ¼ÅŸhane", "Hakkari", "Hatay", "IÄŸdÄ±r", "Isparta", "KahramanmaraÅŸ", "KarabÃ¼k", "Karaman", "Kars", "Kastamonu", "Kayseri", "Kilis", "KÄ±rÄ±kkale", "KÄ±rklareli", "KÄ±rÅŸehir", "Kocaeli", "Konya", "KÃ¼tahya", "Malatya", "Manisa", "Mardin", "Mersin", "MuÄŸla", "MuÅŸ", "NevÅŸehir", "NiÄŸde", "Ordu", "Osmaniye", "Rize", "Sakarya", "Samsun", "ÅanlÄ±urfa", "Siirt", "Sinop", "ÅÄ±rnak", "Sivas", "TekirdaÄŸ", "Tokat", "Trabzon", "Tunceli", "UÅŸak", "Van", "Yalova", "Yozgat", "Zonguldak"];
        const select = document.getElementById('sehir-select');
        sehirler.forEach(s => { let opt = document.createElement('option'); opt.value = s; opt.innerHTML = s; select.appendChild(opt); });

        function openKvkk(e) { if(e) e.preventDefault(); document.getElementById('kvkk-modal').style.display = 'flex'; }
        function closeKvkk() { document.getElementById('kvkk-modal').style.display = 'none'; }

        async function handleRegister() {
            const btn = document.getElementById('submit-btn');
            const chat_id = String(tg.initDataUnsafe?.user?.id || "1017604800");
            const user_name = tg.initDataUnsafe?.user?.username || "Bilinmiyor";
            const gAdi = document.getElementById('galeri-adi').value;
            const yAdi = document.getElementById('yetkili-adi').value;
            const tNo = document.getElementById('tel-no').value;
            const sSehir = document.getElementById('sehir-select').value;
            const kvkkOnay = document.getElementById('kvkk-check').checked;

            if (!gAdi || !yAdi || !tNo || !sSehir) { tg.showAlert("LÃ¼tfen tÃ¼m alanlarÄ± doldurunuz!"); return; }
            if (!kvkkOnay) { tg.HapticFeedback.notificationOccurred('error'); tg.showAlert("LÃ¼tfen KVKK metnini onaylayÄ±nÄ±z."); return; }

            tg.HapticFeedback.impactOccurred('medium');
            btn.innerText = "KAYIT YAPILIYOR...";
            btn.disabled = true;

            try {
                const { error } = await _supabase
                    .from('galeriler')
                    .upsert({
                        chat_id: chat_id,
                        galeri_adi: gAdi,
                        yetkili: yAdi,
                        telefon: tNo,
                        sehir: sSehir,
                        kalan_kredi: 10,
                        logo_gorsel_url: "",
                        adres: sSehir
                    }, { onConflict: 'chat_id' });

                if (error) throw error;

                const webhookUrl = `https://asininventory.com/webhook/kayit-verisi-al?chat_id=${chat_id}&user_name=${encodeURIComponent(user_name)}&galeri_adi=${encodeURIComponent(gAdi)}&yetkili=${encodeURIComponent(yAdi)}&telefon=${encodeURIComponent(tNo)}&sehir=${encodeURIComponent(sSehir)}`;
                fetch(webhookUrl, { mode: 'no-cors' }).catch(console.error);

                tg.HapticFeedback.notificationOccurred('success');
                tg.showPopup({
                    title: 'ğŸ‰ Tebrikler!',
                    message: 'KaydÄ±nÄ±z oluÅŸturuldu ve 10 Kredi hesabÄ±nÄ±za tanÄ±mlandÄ±.',
                    buttons: [{type: 'ok', text: 'KONSEPT SEÃ‡'}]
                }, () => { 
                    window.location.href = 'arka_fon.html'; 
                });

            } catch (err) {
                tg.showAlert("KayÄ±t HatasÄ±: " + err.message);
                btn.innerText = "TEKRAR DENE";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
